{% extends "base.html" %}

{% block title %}LLM Insights · Urban MAS{% endblock %}

{% block content %}
<section class="space-y-8">
  <div class="flex flex-col gap-4 md:flex-row md:items-end md:justify-between">
    <div>
      <h1 class="text-2xl font-semibold tracking-tight text-slate-50 sm:text-3xl">
        LLM Insights – Model analysis
      </h1>
      <p class="mt-1 max-w-2xl text-sm text-slate-400">
        Analytical view of how the LLM shapes coordination decisions, comparing LLM-driven plans and deterministic fallback plans across districts, action types and time windows.
      </p>
    </div>

    <div class="text-xs text-slate-500 md:text-right">
      <div>
        <span class="font-medium text-slate-400">Last update:</span>
        {{ now_utc.strftime("%Y-%m-%d %H:%M UTC") }}
      </div>
      <div>
        Time window:
        {% if time_filtered and window_minutes > 0 %}
          <span class="font-medium text-slate-300">last {{ window_minutes }} minutes</span>
        {% else %}
          <span class="font-medium text-slate-300">all time</span>
        {% endif %}
      </div>
    </div>
  </div>

  <form
    method="get"
    class="space-y-3 rounded-2xl border border-slate-800 bg-slate-900/70 px-4 py-4 text-sm text-slate-200 shadow-sm"
  >
    <div class="grid grid-cols-1 gap-3 md:grid-cols-4">
      <div class="flex flex-col gap-1">
        <label for="f-origin" class="text-xs font-medium uppercase tracking-wide text-slate-500">
          Decision origin
        </label>
        <select
          id="f-origin"
          name="origin"
          class="w-full rounded-lg border border-slate-700 bg-slate-950 px-2 py-1 text-sm text-slate-100 outline-none focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500"
        >
          <option value="all" {% if selected_origin == "all" %}selected{% endif %}>All</option>
          <option value="llm" {% if selected_origin == "llm" %}selected{% endif %}>LLM only</option>
          <option value="fallback" {% if selected_origin == "fallback" %}selected{% endif %}>Fallback only</option>
        </select>
      </div>

      <div class="flex flex-col gap-1">
        <label for="f-source" class="text-xs font-medium uppercase tracking-wide text-slate-500">
          Source district
        </label>
        <select
          id="f-source"
          name="source_district"
          class="w-full rounded-lg border border-slate-700 bg-slate-950 px-2 py-1 text-sm text-slate-100 outline-none focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500"
        >
          <option value="">All</option>
          {% for d in source_districts %}
            <option value="{{ d }}" {% if selected_source_district == d %}selected{% endif %}>
              {{ d }}
            </option>
          {% endfor %}
        </select>
      </div>

      <div class="flex flex-col gap-1">
        <label for="f-target" class="text-xs font-medium uppercase tracking-wide text-slate-500">
          Target district
        </label>
        <select
          id="f-target"
          name="target_district"
          class="w-full rounded-lg border border-slate-700 bg-slate-950 px-2 py-1 text-sm text-slate-100 outline-none focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500"
        >
          <option value="">All</option>
          {% for d in target_districts %}
            <option value="{{ d }}" {% if selected_target_district == d %}selected{% endif %}>
              {{ d }}
            </option>
          {% endfor %}
        </select>
      </div>

      <div class="flex flex-col gap-1">
        <label for="f-action-type" class="text-xs font-medium uppercase tracking-wide text-slate-500">
          Action type
        </label>
        <select
          id="f-action-type"
          name="action_type"
          class="w-full rounded-lg border border-slate-700 bg-slate-950 px-2 py-1 text-sm text-slate-100 outline-none focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500"
        >
          <option value="">All</option>
          {% for t in action_types %}
            <option value="{{ t }}" {% if selected_action_type == t %}selected{% endif %}>
              {{ t }}
            </option>
          {% endfor %}
        </select>
      </div>
    </div>

    <div class="grid grid-cols-1 gap-3 md:grid-cols-[minmax(0,2fr)_minmax(0,1fr)_auto]">
      <div class="flex flex-col gap-1">
        <label for="f-window" class="text-xs font-medium uppercase tracking-wide text-slate-500">
          Time window
        </label>
        <select
          id="f-window"
          name="window_minutes"
          class="w-full rounded-lg border border-slate-700 bg-slate-950 px-2 py-1 text-sm text-slate-100 outline-none focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500"
        >
          <option value="0" {% if window_minutes == 0 %}selected{% endif %}>All time</option>
          <option value="15" {% if window_minutes == 15 %}selected{% endif %}>Last 15 minutes</option>
          <option value="30" {% if window_minutes == 30 %}selected{% endif %}>Last 30 minutes</option>
          <option value="60" {% if window_minutes == 60 %}selected{% endif %}>Last 60 minutes</option>
          <option value="120" {% if window_minutes == 120 %}selected{% endif %}>Last 2 hours</option>
        </select>
      </div>

      <div class="flex flex-col gap-1">
        <label for="f-limit" class="text-xs font-medium uppercase tracking-wide text-slate-500">
          Limit
        </label>
        <select
          id="f-limit"
          name="limit"
          class="w-full rounded-lg border border-slate-700 bg-slate-950 px-2 py-1 text-sm text-slate-100 outline-none focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500"
        >
          <option value="0" {% if limit == 0 %}selected{% endif %}>All</option>
          <option value="50" {% if limit == 50 %}selected{% endif %}>50</option>
          <option value="100" {% if limit == 100 %}selected{% endif %}>100</option>
          <option value="200" {% if limit == 200 %}selected{% endif %}>200</option>
        </select>
      </div>

      <div class="flex items-end justify-start gap-2 md:justify-end">
        <button
          type="submit"
          class="inline-flex items-center rounded-lg bg-emerald-500 px-3 py-1.5 text-xs font-semibold text-slate-950 shadow-sm hover:bg-emerald-400 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2 focus:ring-offset-slate-900"
        >
          Apply filters
        </button>
        <a
          href="/llm-insights"
          class="inline-flex items-center rounded-lg border border-slate-700 bg-slate-900 px-3 py-1.5 text-xs font-semibold text-slate-200 hover:bg-slate-800"
        >
          Reset
        </a>
      </div>
    </div>
  </form>

  <section class="grid grid-cols-1 gap-4 text-xs text-slate-300 sm:grid-cols-2 lg:grid-cols-4">
    <div class="rounded-2xl border border-slate-800 bg-slate-900/70 px-3 py-3">
      <div class="text-[0.65rem] uppercase tracking-wide text-slate-500">
        Total coordinated actions (filtered)
      </div>
      <div class="mt-1 text-lg font-semibold text-slate-50">
        {{ filtered_actions_count }}
      </div>
      <div class="mt-1 text-[0.7rem] text-slate-500">
        {% if limit == 0 %}
          Showing
          <span class="font-medium text-slate-300">{{ filtered_actions_count }}</span>
          actions (all results) · Total in DB:
          <span class="font-medium text-slate-300">{{ total_actions_count }}</span>
        {% else %}
          Showing up to
          <span class="font-medium text-slate-300">{{ limit }}</span>
          actions · Total in DB:
          <span class="font-medium text-slate-300">{{ total_actions_count }}</span>
        {% endif %}
      </div>
    </div>

    <div class="rounded-2xl border border-slate-800 bg-slate-900/70 px-3 py-3">
      <div class="text-[0.65rem] uppercase tracking-wide text-slate-500">
        LLM-driven plans
      </div>
      <div class="mt-1 text-lg font-semibold text-emerald-300">
        {{ llm_actions_count }}
      </div>
      <div class="mt-1 text-[0.7rem] text-slate-500">
        Approx. <span class="font-medium text-emerald-200">{{ llm_pct }}%</span> of filtered actions.
      </div>
    </div>

    <div class="rounded-2xl border border-slate-800 bg-slate-900/70 px-3 py-3">
      <div class="text-[0.65rem] uppercase tracking-wide text-slate-500">
        Fallback-based plans
      </div>
      <div class="mt-1 text-lg font-semibold text-amber-300">
        {{ fallback_actions_count }}
      </div>
      <div class="mt-1 text-[0.7rem] text-slate-500">
        Approx. <span class="font-medium text-amber-200">{{ fallback_pct }}%</span> of filtered actions.
      </div>
    </div>

    <div class="rounded-2xl border border-slate-800 bg-slate-900/70 px-3 py-3">
      <div class="text-[0.65rem] uppercase tracking-wide text-slate-500">
        Districts impacted by LLM
      </div>
      <div class="mt-1 text-lg font-semibold text-sky-300">
        {{ districts_impacted_by_llm }}
      </div>
      <div class="mt-1 text-[0.7rem] text-slate-500">
        Out of
        <span class="font-medium text-slate-300">{{ total_districts_with_actions }}</span>
        districts with at least one coordinated action.
      </div>
    </div>
  </section>

  <section class="grid grid-cols-1 gap-4 lg:grid-cols-2">
    <div class="space-y-3 rounded-2xl border border-slate-800 bg-slate-900/70 p-4">
      <header class="flex items-center justify-between">
        <div>
          <h2 class="text-sm font-semibold uppercase tracking-wide text-slate-400">
            LLM vs fallback – distribution
          </h2>
          <p class="mt-0.5 text-xs text-slate-500">
            Comparison between LLM-generated plans and deterministic fallback plans
            in the filtered dataset.
          </p>
        </div>
      </header>

      <div class="space-y-2 text-xs">
        <div class="flex items-center justify-between">
          <span class="text-slate-300">LLM plans</span>
          <span class="font-medium text-emerald-300">{{ llm_pct }}%</span>
        </div>
        <div class="h-2 w-full rounded-full bg-slate-800">
          <div
            class="h-2 rounded-full bg-emerald-500/80"
            data-bar-pct="{{ llm_pct }}"
          ></div>
        </div>

        <div class="mt-3 flex items-center justify-between">
          <span class="text-slate-300">Fallback plans</span>
          <span class="font-medium text-amber-300">{{ fallback_pct }}%</span>
        </div>
        <div class="h-2 w-full rounded-full bg-slate-800">
          <div
            class="h-2 rounded-full bg-amber-500/80"
            data-bar-pct="{{ fallback_pct }}"
          ></div>
        </div>
      </div>

      <div class="mt-4 border-t border-slate-800 pt-3 text-xs text-slate-400">
        <div class="mb-1 text-[0.7rem] font-semibold uppercase tracking-wide text-slate-500">
          District breakdown (target)
        </div>
        {% if district_stats %}
          <div class="space-y-1">
            {% for d in district_stats %}
              <div class="flex items-center justify-between gap-2">
                <div class="flex-1 truncate text-[0.75rem] text-slate-300">
                  {{ d.district }}
                </div>
                <div class="flex items-center gap-2 text-[0.7rem]">
                  <span class="text-emerald-300">LLM: {{ d.llm }}</span>
                  <span class="text-amber-300">FB: {{ d.fallback }}</span>
                  <span class="text-slate-500">Total: {{ d.total }}</span>
                </div>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <div class="text-[0.7rem] text-slate-500">
            No coordinated actions match the selected filters.
          </div>
        {% endif %}
      </div>
    </div>

    <div class="space-y-3 rounded-2xl border border-slate-800 bg-slate-900/70 p-4">
      <header class="flex items-center justify-between">
        <div>
          <h2 class="text-sm font-semibold uppercase tracking-wide text-slate-400">
            Actions by type &amp; origin
          </h2>
          <p class="mt-0.5 text-xs text-slate-500">
            Comparison between LLM and fallback decisions for each coordination action type.
          </p>
        </div>
      </header>

      {% if action_type_stats %}
        <div class="max-h-72 overflow-auto rounded-xl border border-slate-800 bg-slate-950/40">
          <table class="min-w-full table-fixed text-left text-xs">
            <thead
              class="sticky top-0 z-10 bg-slate-900/95 text-[0.65rem] uppercase tracking-wide text-slate-500"
            >
              <tr>
                <th class="px-3 py-2 whitespace-nowrap">Action type</th>
                <th class="px-3 py-2 whitespace-nowrap">LLM</th>
                <th class="px-3 py-2 whitespace-nowrap">Fallback</th>
                <th class="px-3 py-2 whitespace-nowrap">Total</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-slate-800">
              {% for row in action_type_stats %}
                <tr class="bg-slate-950/40 hover:bg-slate-900/80">
                  <td class="px-3 py-2 text-slate-100 whitespace-nowrap">
                    {{ row.action_type }}
                  </td>
                  <td class="px-3 py-2 text-emerald-300 whitespace-nowrap">
                    {{ row.llm }}
                  </td>
                  <td class="px-3 py-2 text-amber-300 whitespace-nowrap">
                    {{ row.fallback }}
                  </td>
                  <td class="px-3 py-2 text-slate-300 whitespace-nowrap">
                    {{ row.total }}
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <div
          class="rounded-xl border border-dashed border-slate-700 bg-slate-950/40 p-4 text-xs text-slate-500"
        >
          No coordinated actions match the selected filters.
        </div>
      {% endif %}
    </div>
  </section>

  <section class="space-y-3">
    <header class="flex flex-col gap-1 sm:flex-row sm:items-center sm:justify-between">
      <h2 class="text-sm font-semibold uppercase tracking-wide text-slate-400">
        Decision log – LLM vs fallback
      </h2>
      <p class="text-xs text-slate-500">
        Detailed list of individual coordination actions, with decision origin (LLM or fallback)
        and the characteristics of the associated critical event.
      </p>
    </header>

    {% if decisions %}
      <div
        class="hidden max-h-[640px] overflow-auto rounded-2xl border border-slate-800 bg-slate-950/40 md:block"
      >
        <table class="min-w-full table-fixed text-left text-xs">
          <thead
            class="sticky top-0 z-10 bg-slate-900/95 text-[0.65rem] uppercase tracking-wide text-slate-500"
          >
            <tr>
              <th class="px-3 py-2 whitespace-nowrap">ID</th>
              <th class="px-3 py-2 whitespace-nowrap">Created at</th>
              <th class="px-3 py-2 whitespace-nowrap">Origin</th>
              <th class="px-3 py-2 whitespace-nowrap">Source</th>
              <th class="px-3 py-2 whitespace-nowrap">Target</th>
              <th class="px-3 py-2 whitespace-nowrap">Action type</th>
              <th class="px-3 py-2 whitespace-nowrap">Event sensor</th>
              <th class="px-3 py-2 whitespace-nowrap">Event severity</th>
              <th class="px-3 py-2 whitespace-nowrap">Reason</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-slate-800">
            {% for d in decisions %}
              {% set origin = d.origin %}
              {% if origin == "llm" %}
                {% set origin_classes = "bg-emerald-500/15 text-emerald-300 ring-emerald-500/40" %}
                {% set origin_label = "LLM" %}
              {% else %}
                {% set origin_classes = "bg-amber-500/15 text-amber-300 ring-amber-500/40" %}
                {% set origin_label = "Fallback" %}
              {% endif %}

              {% set sev = (d.event_severity or "")|lower %}
              {% if sev == "high" %}
                {% set sev_color = "bg-rose-500/15 text-rose-300 ring-rose-500/40" %}
              {% elif sev == "medium" %}
                {% set sev_color = "bg-amber-500/15 text-amber-300 ring-amber-500/40" %}
              {% elif sev == "low" %}
                {% set sev_color = "bg-emerald-500/15 text-emerald-300 ring-emerald-500/40" %}
              {% else %}
                {% set sev_color = "bg-slate-600/20 text-slate-200 ring-slate-500/40" %}
              {% endif %}

              <tr
                class="cursor-pointer bg-slate-950/40 hover:bg-slate-900/80"
                data-decision-row
                data-decision-id="{{ d.id }}"
                data-decision-created="{% if d.created_at %}{{ d.created_at.strftime("%Y-%m-%d %H:%M:%S UTC") }}{% endif %}"
                data-decision-origin="{{ origin_label }}"
                data-decision-source="{{ d.source_district }}"
                data-decision-target="{{ d.target_district }}"
                data-decision-action-type="{{ d.action_type }}"
                data-decision-reason="{{ d.reason }}"
                data-decision-event-sensor="{{ d.event_sensor_type }}"
                data-decision-event-severity="{{ d.event_severity }}"
                data-decision-event-district="{{ d.event_district }}"
                data-decision-event-timestamp="{{ d.event_timestamp }}"
                data-decision-event-value="{{ d.event_value }}"
                data-decision-event-unit="{{ d.event_unit }}"
                data-decision-event-topic="{{ d.event_topic }}"
              >
                <td class="px-3 py-2 text-slate-500 whitespace-nowrap">
                  {{ d.id }}
                </td>
                <td class="px-3 py-2 text-slate-400 whitespace-nowrap">
                  {% if d.created_at %}
                    {{ d.created_at.strftime("%Y-%m-%d %H:%M:%S UTC") }}
                  {% else %}
                    —
                  {% endif %}
                </td>
                <td class="px-3 py-2 whitespace-nowrap">
                  <span
                    class="inline-flex items-center rounded-full px-2 py-0.5 text-[0.65rem] font-medium ring-1 {{ origin_classes }}"
                  >
                    {{ origin_label }}
                  </span>
                </td>
                <td class="px-3 py-2 text-slate-100 whitespace-nowrap">
                  {{ d.source_district }}
                </td>
                <td class="px-3 py-2 text-slate-100 whitespace-nowrap">
                  {{ d.target_district }}
                </td>
                <td class="px-3 py-2 text-slate-100 whitespace-nowrap">
                  {{ d.action_type }}
                </td>
                <td class="px-3 py-2 text-slate-200 whitespace-nowrap">
                  {{ d.event_sensor_type or "—" }}
                </td>
                <td class="px-3 py-2 whitespace-nowrap">
                  {% if d.event_severity %}
                    <span
                      class="inline-flex items-center rounded-full px-2 py-0.5 text-[0.65rem] font-medium ring-1 {{ sev_color }}"
                    >
                      {{ d.event_severity }}
                    </span>
                  {% else %}
                    <span class="text-slate-500">—</span>
                  {% endif %}
                </td>
                <td class="px-3 py-2 text-[0.7rem] text-slate-400 max-w-[14rem] truncate">
                  {{ d.reason or "—" }}
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <div class="space-y-3 md:hidden">
        {% for d in decisions %}
          {% set origin = d.origin %}
          {% if origin == "llm" %}
            {% set origin_classes = "bg-emerald-500/15 text-emerald-300 ring-emerald-500/40" %}
            {% set origin_label = "LLM" %}
          {% else %}
            {% set origin_classes = "bg-amber-500/15 text-amber-300 ring-amber-500/40" %}
            {% set origin_label = "Fallback" %}
          {% endif %}

          {% set sev = (d.event_severity or "")|lower %}
          {% if sev == "high" %}
            {% set sev_color = "bg-rose-500/15 text-rose-300 ring-rose-500/40" %}
          {% elif sev == "medium" %}
            {% set sev_color = "bg-amber-500/15 text-amber-300 ring-amber-500/40" %}
          {% elif sev == "low" %}
            {% set sev_color = "bg-emerald-500/15 text-emerald-300 ring-emerald-500/40" %}
          {% else %}
            {% set sev_color = "bg-slate-600/20 text-slate-200 ring-slate-500/40" %}
          {% endif %}

          <article
            class="cursor-pointer rounded-2xl border border-slate-800 bg-slate-900/70 p-3 shadow-sm"
            data-decision-row
            data-decision-id="{{ d.id }}"
            data-decision-created="{% if d.created_at %}{{ d.created_at.strftime("%Y-%m-%d %H:%M:%S UTC") }}{% endif %}"
            data-decision-origin="{{ origin_label }}"
            data-decision-source="{{ d.source_district }}"
            data-decision-target="{{ d.target_district }}"
            data-decision-action-type="{{ d.action_type }}"
            data-decision-reason="{{ d.reason }}"
            data-decision-event-sensor="{{ d.event_sensor_type }}"
            data-decision-event-severity="{{ d.event_severity }}"
            data-decision-event-district="{{ d.event_district }}"
            data-decision-event-timestamp="{{ d.event_timestamp }}"
            data-decision-event-value="{{ d.event_value }}"
            data-decision-event-unit="{{ d.event_unit }}"
            data-decision-event-topic="{{ d.event_topic }}"
          >
            <div class="flex items-center justify-between gap-2">
              <div class="text-sm font-semibold text-slate-50">
                #{{ d.id }} · {{ d.source_district }} → {{ d.target_district }}
              </div>
              <span
                class="inline-flex items-center rounded-full px-2 py-0.5 text-[0.65rem] font-medium ring-1 {{ origin_classes }}"
              >
                {{ origin_label }}
              </span>
            </div>
            <div class="mt-1 text-xs text-slate-400">
              {% if d.created_at %}
                {{ d.created_at.strftime("%Y-%m-%d %H:%M:%S UTC") }}
              {% else %}
                —
              {% endif %}
            </div>
            <div class="mt-1 text-xs text-slate-400">
              Action:
              <span class="text-slate-200">{{ d.action_type }}</span>
            </div>
            <div class="mt-1 text-xs text-slate-400">
              Event:
              <span class="text-slate-200">{{ d.event_sensor_type or "—" }}</span>
              {% if d.event_severity %}
                ·
                <span
                  class="inline-flex items-center rounded-full px-2 py-0.5 text-[0.65rem] font-medium ring-1 {{ sev_color }}"
                >
                  {{ d.event_severity }}
                </span>
              {% endif %}
            </div>
            <div class="mt-2 text-[0.7rem] text-slate-500 max-w-full truncate">
              {{ d.reason or "—" }}
            </div>
          </article>
        {% endfor %}
      </div>
    {% else %}
      <div
        class="rounded-2xl border border-dashed border-slate-700 bg-slate-900/60 p-6 text-center text-sm text-slate-500"
      >
        No coordinated actions match the selected filters.
        <br />
        Try relaxing the time window or changing the decision origin filter.
      </div>
    {% endif %}
  </section>
</section>

<div
  id="decision-modal"
  class="fixed inset-0 z-50 hidden flex items-center justify-center px-4"
>
  <div
    data-modal-overlay
    class="absolute inset-0 bg-slate-950/80"
  ></div>
  <div
    class="relative z-10 w-full max-w-lg rounded-2xl border border-slate-800 bg-slate-900/95 p-5 shadow-xl"
  >
    <header class="mb-3 flex items-center justify-between gap-2">
      <div>
        <h3 class="text-sm font-semibold text-slate-50">
          Decision details
        </h3>
        <p class="text-xs text-slate-500">
          Full details for the selected coordination action and its originating event snapshot.
        </p>
      </div>
      <button
        type="button"
        data-modal-close
        class="inline-flex h-7 w-7 items-center justify-center rounded-full border border-slate-700 bg-slate-900 text-slate-400 hover:bg-slate-800 hover:text-slate-100"
      >
        ✕
      </button>
    </header>

    <div class="space-y-4 text-xs text-slate-300">
      <section class="space-y-2">
        <h4 class="text-[0.7rem] font-semibold uppercase tracking-wide text-slate-500">
          Coordination action
        </h4>
        <dl class="space-y-2">
          <div class="grid grid-cols-[130px_minmax(0,1fr)] gap-2">
            <dt class="text-slate-500">ID</dt>
            <dd data-field="id" class="font-medium text-slate-100"></dd>
          </div>
          <div class="grid grid-cols-[130px_minmax(0,1fr)] gap-2">
            <dt class="text-slate-500">Created at</dt>
            <dd data-field="created_at" class="text-slate-100"></dd>
          </div>
          <div class="grid grid-cols-[130px_minmax(0,1fr)] gap-2">
            <dt class="text-slate-500">Decision origin</dt>
            <dd data-field="origin" class="font-medium text-slate-100"></dd>
          </div>
          <div class="grid grid-cols-[130px_minmax(0,1fr)] gap-2">
            <dt class="text-slate-500">Source district</dt>
            <dd data-field="source" class="font-medium text-slate-100"></dd>
          </div>
          <div class="grid grid-cols-[130px_minmax(0,1fr)] gap-2">
            <dt class="text-slate-500">Target district</dt>
            <dd data-field="target" class="font-medium text-slate-100"></dd>
          </div>
          <div class="grid grid-cols-[130px_minmax(0,1fr)] gap-2">
            <dt class="text-slate-500">Action type</dt>
            <dd data-field="action_type" class="font-medium text-slate-100"></dd>
          </div>
          <div class="grid grid-cols-[130px_minmax(0,1fr)] gap-2">
            <dt class="text-slate-500">Reason</dt>
            <dd data-field="reason" class="text-slate-100"></dd>
          </div>
        </dl>
      </section>

      <section class="space-y-2">
        <h4 class="text-[0.7rem] font-semibold uppercase tracking-wide text-slate-500">
          Originating event (snapshot)
        </h4>
        <dl class="space-y-2">
          <div class="grid grid-cols-[130px_minmax(0,1fr)] gap-2">
            <dt class="text-slate-500">Event district</dt>
            <dd data-field="event_district" class="font-medium text-slate-100"></dd>
          </div>
          <div class="grid grid-cols-[130px_minmax(0,1fr)] gap-2">
            <dt class="text-slate-500">Event sensor</dt>
            <dd data-field="event_sensor_type" class="font-medium text-slate-100"></dd>
          </div>
          <div class="grid grid-cols-[130px_minmax(0,1fr)] gap-2">
            <dt class="text-slate-500">Event value</dt>
            <dd data-field="event_value" class="text-slate-100"></dd>
          </div>
          <div class="grid grid-cols-[130px_minmax(0,1fr)] gap-2">
            <dt class="text-slate-500">Event severity</dt>
            <dd data-field="event_severity" class="text-slate-100"></dd>
          </div>
          <div class="grid grid-cols-[130px_minmax(0,1fr)] gap-2">
            <dt class="text-slate-500">Event timestamp</dt>
            <dd data-field="event_timestamp" class="text-slate-100"></dd>
          </div>
          <div class="grid grid-cols-[130px_minmax(0,1fr)] gap-2">
            <dt class="text-slate-500">Event topic</dt>
            <dd data-field="event_topic" class="text-slate-100 break-all"></dd>
          </div>
        </dl>
      </section>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
  <script src="/static/js/llm_insights.js"></script>
{% endblock %}